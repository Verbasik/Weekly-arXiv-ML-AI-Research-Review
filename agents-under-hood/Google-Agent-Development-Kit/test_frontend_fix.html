<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Тест исправления ошибки</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-case { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 3px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>Тест исправления ошибки TypeError</h1>
    
    <div class="test-case success">
        <h3>✅ Тест 1: Полные данные</h3>
        <p>Проверка с полными данными от API:</p>
        <pre id="test1"></pre>
    </div>
    
    <div class="test-case success">
        <h3>✅ Тест 2: Отсутствующий summary</h3>
        <p>Проверка с отсутствующим полем summary:</p>
        <pre id="test2"></pre>
    </div>
    
    <div class="test-case success">
        <h3>✅ Тест 3: Частичные данные</h3>
        <p>Проверка с частичными данными:</p>
        <pre id="test3"></pre>
    </div>

    <script>
        // Функция для безопасного отображения сводки изменений
        function renderSummary(analysisResult) {
            if (!analysisResult) return 'Данные недоступны';
            
            const summary = analysisResult.summary;
            if (!summary) return 'Сводка изменений недоступна';
            
            let result = `Всего изменений: ${summary.total_changes || 0}\n`;
            
            if (summary.by_type) {
                result += 'По типам:\n';
                Object.entries(summary.by_type).forEach(([type, count]) => {
                    result += `  ${type}: ${count}\n`;
                });
            }
            
            if (summary.by_language && Object.keys(summary.by_language).length > 0) {
                result += 'По языкам программирования:\n';
                Object.entries(summary.by_language).forEach(([lang, count]) => {
                    result += `  ${lang}: ${count}\n`;
                });
            }
            
            return result;
        }

        // Тестовые данные
        const testData1 = {
            status: {
                branch: 'main',
                staged_files: ['file1.py', 'file2.js'],
                modified_files: ['file3.py'],
                untracked_files: ['file4.txt']
            },
            summary: {
                total_changes: 4,
                by_type: {
                    'modified': 2,
                    'added': 1,
                    'staged': 1
                },
                by_language: {
                    'Python': 2,
                    'JavaScript': 1,
                    'Text': 1
                }
            },
            analysis: 'feat: add new features and update existing code',
            changes: [
                { file_path: 'file1.py', change_type: 'modified', language: 'Python' },
                { file_path: 'file2.js', change_type: 'added', language: 'JavaScript' }
            ]
        };

        const testData2 = {
            status: {
                branch: 'main',
                staged_files: [],
                modified_files: [],
                untracked_files: []
            },
            analysis: 'Нет изменений для анализа',
            changes: []
            // summary отсутствует
        };

        const testData3 = {
            status: null,
            summary: {
                total_changes: 1,
                by_type: { 'modified': 1 }
                // by_language отсутствует
            },
            analysis: null,
            changes: [
                { file_path: 'unknown.txt', change_type: null, language: null }
            ]
        };

        // Выполнение тестов
        document.getElementById('test1').textContent = renderSummary(testData1);
        document.getElementById('test2').textContent = renderSummary(testData2);
        document.getElementById('test3').textContent = renderSummary(testData3);

        console.log('✅ Все тесты выполнены успешно!');
        console.log('Тест 1:', renderSummary(testData1));
        console.log('Тест 2:', renderSummary(testData2));
        console.log('Тест 3:', renderSummary(testData3));
    </script>
</body>
</html> 