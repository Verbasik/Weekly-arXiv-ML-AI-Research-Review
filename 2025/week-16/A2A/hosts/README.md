# –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è A2A –∫–ª–∏–µ–Ω—Ç–æ–≤

<div align="center">
<img src="/api/placeholder/800/250" alt="A2A –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–µ –†–µ–∞–ª–∏–∑–∞—Ü–∏–∏" />

![Python 3.9+](https://img.shields.io/badge/Python-3.9+-blue.svg)
![Asyncio](https://img.shields.io/badge/Async-asyncio-green.svg)
![A2A Protocol](https://img.shields.io/badge/Protocol-A2A-purple.svg)
![Google ADK](https://img.shields.io/badge/Framework-Google_ADK-red.svg)
</div>

## üìë –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–û–±–∑–æ—Ä –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã](#-–æ–±–∑–æ—Ä-–∫–æ–¥–æ–≤–æ–π-–±–∞–∑—ã)
- [CLI –∫–ª–∏–µ–Ω—Ç](#-cli-–∫–ª–∏–µ–Ω—Ç)
  - [–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã](#–æ—Å–Ω–æ–≤–Ω—ã–µ-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã)
  - [–§—É–Ω–∫—Ü–∏–∏ –∏ –∫–ª–∞—Å—Å—ã](#—Ñ—É–Ω–∫—Ü–∏–∏-–∏-–∫–ª–∞—Å—Å—ã)
  - [–û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤](#–æ–±—Ä–∞–±–æ—Ç–∫–∞-–∑–∞–ø—Ä–æ—Å–æ–≤-–∏-–æ—Ç–≤–µ—Ç–æ–≤)
  - [Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è](#push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è)
- [–ú—É–ª—å—Ç–∏–∞–≥–µ–Ω—Ç–Ω—ã–π –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä](#-–º—É–ª—å—Ç–∏–∞–≥–µ–Ω—Ç–Ω—ã–π-–æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä)
  - [–ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã](#–∫–ª—é—á–µ–≤—ã–µ-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã)
  - [HostAgent: –æ—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å](#hostagent-–æ—Å–Ω–æ–≤–Ω–æ–π-–∫–ª–∞—Å—Å)
  - [–ú–µ—Ö–∞–Ω–∏–∑–º –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–¥–∞—á](#–º–µ—Ö–∞–Ω–∏–∑–º-–¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏—è-–∑–∞–¥–∞—á)
  - [–û–±—Ä–∞–±–æ—Ç–∫–∞ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö](#–æ–±—Ä–∞–±–æ—Ç–∫–∞-–º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö)
- [–ü–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö](#-–ø–æ—Ç–æ–∫–∏-–¥–∞–Ω–Ω—ã—Ö)
  - [CLI –∫–ª–∏–µ–Ω—Ç](#–ø–æ—Ç–æ–∫-–¥–∞–Ω–Ω—ã—Ö-cli-–∫–ª–∏–µ–Ω—Ç–∞)
  - [Multi-Agent –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä](#–ø–æ—Ç–æ–∫-–¥–∞–Ω–Ω—ã—Ö-multi-agent-–æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞)
- [–ü—Ä–∏–º–µ—Ä—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏](#-–ø—Ä–∏–º–µ—Ä—ã-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏)

## üîç –û–±–∑–æ—Ä –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã

–ö–æ–¥–æ–≤–∞—è –±–∞–∑–∞ A2A –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –¥–≤—É—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:

1. **CLI –∫–ª–∏–µ–Ω—Ç** (`hosts/cli/`) - –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å A2A —Å–µ—Ä–≤–µ—Ä–∞–º–∏:
   - `__main__.py` - —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –∏ –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è
   - `push_notification_listener.py` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

2. **Multi-Agent –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä** (`hosts/multiagent/`) - –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –∞–≥–µ–Ω—Ç–∞–º–∏:
   - `agent.py` - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ—Ä–Ω–µ–≤–æ–≥–æ –∞–≥–µ–Ω—Ç–∞
   - `host_agent.py` - –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞ –∞–≥–µ–Ω—Ç–æ–≤ –∏ –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–¥–∞—á
   - `remote_agent_connection.py` - –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å —É–¥–∞–ª–µ–Ω–Ω—ã–º–∏ –∞–≥–µ–Ω—Ç–∞–º–∏

–û–±–∞ –∫–ª–∏–µ–Ω—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –±–∞–∑–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ `common`, –≤ —á–∞—Å—Ç–Ω–æ—Å—Ç–∏:
- `A2AClient` - –∫–ª–∏–µ–Ω—Ç –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å A2A API
- `A2ACardResolver` - –ø–æ–ª—É—á–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –∞–≥–µ–Ω—Ç–∞ (AgentCard)
- `PushNotificationReceiverAuth` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ `common.types` –¥–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—Ç–≤–µ—Ç–æ–≤

## üíª CLI –∫–ª–∏–µ–Ω—Ç

CLI –∫–ª–∏–µ–Ω—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –∫–æ–Ω—Å–æ–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –ø—Ä—è–º–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å A2A –∞–≥–µ–Ω—Ç–∞–º–∏. –û–Ω –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –∫–∞–∫ –±–∞–∑–æ–≤—ã–π —Ä–µ–∂–∏–º –∑–∞–ø—Ä–æ—Å-–æ—Ç–≤–µ—Ç, —Ç–∞–∫ –∏ –±–æ–ª–µ–µ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏, —Ç–∞–∫–∏–µ –∫–∞–∫ –ø–æ—Ç–æ–∫–æ–≤–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

```python
# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞ –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –∞–≥–µ–Ω—Ç–æ–º
@click.command()
async def cli(agent, session, history, use_push_notifications, push_notification_receiver):
    # –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –∞–≥–µ–Ω—Ç–∞
    card_resolver = A2ACardResolver(agent)
    card = card_resolver.get_agent_card()
    
    # –ó–∞–ø—É—Å–∫ —Å–ª—É—à–∞—Ç–µ–ª—è push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
    if use_push_notifications:
        push_notification_listener = PushNotificationListener(...)
        push_notification_listener.start()
        
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞ –∏ —Å–µ—Å—Å–∏–∏
    client = A2AClient(agent_card=card)
    session_id = uuid4().hex if session == 0 else str(session)
    
    # –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è
    while continue_loop:
        continue_loop = await complete_task(...)
```

### –§—É–Ω–∫—Ü–∏–∏ –∏ –∫–ª–∞—Å—Å—ã

#### 1. `cli()`
–û—Å–Ω–æ–≤–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∞—Ä–≥—É–º–µ–Ω—Ç—ã –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
- –ü–æ–ª—É—á–∞–µ—Ç –∫–∞—Ä—Ç–æ—á–∫—É –∞–≥–µ–Ω—Ç–∞ —á–µ—Ä–µ–∑ `A2ACardResolver`
- –ó–∞–ø—É—Å–∫–∞–µ—Ç —Å–ª—É—à–∞—Ç–µ–ª—å push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
- –£–ø—Ä–∞–≤–ª—è–µ—Ç —Ü–∏–∫–ª–æ–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –∞–≥–µ–Ω—Ç–æ–º

```python
@click.command()
@click.option("--agent", default="http://localhost:10000", help="URL –∞–≥–µ–Ω—Ç–∞ –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è")
@click.option("--session", default=0, help="ID —Å–µ—Å—Å–∏–∏ (0 = —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é)")
@click.option("--history", default=False, help="–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é —Å–æ–æ–±—â–µ–Ω–∏–π")
@click.option("--use_push_notifications", default=False, help="–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è")
@click.option(
    "--push_notification_receiver", 
    default="http://localhost:5000", 
    help="URL –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π"
)
async def cli(...):
    # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è
```

#### 2. `complete_task()`
–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ –≤ —Ä–∞–º–∫–∞—Ö –¥–∏–∞–ª–æ–≥–∞:
- –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –≤–≤–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –§–æ—Ä–º–∏—Ä—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –≤ –ø–æ—Ç–æ–∫–æ–≤–æ–º –∏–ª–∏ –æ–±—ã—á–Ω–æ–º —Ä–µ–∂–∏–º–µ
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è –¥–∏–∞–ª–æ–≥–∞

```python
async def complete_task(
    client: A2AClient, 
    streaming: bool, 
    use_push_notifications: bool, 
    notification_receiver_host: str, 
    notification_receiver_port: int, 
    task_id: str, 
    session_id: str
) -> bool:
    # –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –≤–≤–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    prompt = click.prompt("\nWhat do you want to send to the agent? (:q or quit to exit)")
    
    # –§–æ—Ä–º–∏—Ä—É–µ–º –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å
    # ...
    
    # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –æ—Ç–≤–µ—Ç
    # ...
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –≤–≤–æ–¥–∞
    state = TaskState(task_result.result.status.state)
    if state.name == TaskState.INPUT_REQUIRED.name:
        # –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –≤—ã–∑–æ–≤ –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è –¥–∏–∞–ª–æ–≥–∞
        return await complete_task(...)
    else:
        # –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è
        return True
```

#### 3. `PushNotificationListener`
–ö–ª–∞—Å—Å –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ—Ç A2A –∞–≥–µ–Ω—Ç–∞:
- –ó–∞–ø—É—Å–∫–∞–µ—Ç HTTP-—Å–µ—Ä–≤–µ—Ä –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–æ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã (GET)
- –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –∏ –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (POST)
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç JWT –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

```python
class PushNotificationListener:
    def __init__(
        self, 
        host: str, 
        port: int, 
        notification_receiver_auth: PushNotificationReceiverAuth
    ) -> None:
        # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
        
    def start(self) -> None:
        # –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ
        
    async def start_server(self) -> None:
        # –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∑–∞–ø—É—Å–∫ HTTP-—Å–µ—Ä–≤–µ—Ä–∞
        
    async def handle_validation_check(self, request: Request) -> Response:
        # –û–±—Ä–∞–±–æ—Ç–∫–∞ GET-–∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ç–æ–∫–µ–Ω–∞
        
    async def handle_notification(self, request: Request) -> Response:
        # –û–±—Ä–∞–±–æ—Ç–∫–∞ POST-–∑–∞–ø—Ä–æ—Å–æ–≤ —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤

–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å A2A –∞–≥–µ–Ω—Ç–æ–º –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `complete_task()`:

1. **–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞**:
```python
payload = {
    "id": task_id,
    "sessionId": session_id,
    "acceptedOutputModes": ["text"],
    "message": {
        "role": "user",
        "parts": [
            {
                "type": "text",
                "text": prompt,
            }
        ],
    },
}

# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
if use_push_notifications:
    payload["pushNotification"] = {
        "url": f"http://{notification_receiver_host}:{notification_receiver_port}/notify",
        "authentication": {
            "schemes": ["bearer"],
        },
    }
```

2. **–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞** (–¥–≤–∞ —Ä–µ–∂–∏–º–∞):
```python
# –ü–æ—Ç–æ–∫–æ–≤—ã–π —Ä–µ–∂–∏–º (streaming)
if streaming:
    response_stream = client.send_task_streaming(payload)
    async for result in response_stream:
        print(f"stream event => {result.model_dump_json(exclude_none=True)}")
    task_result = await client.get_task({"id": task_id})
# –û–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º
else:
    task_result = await client.send_task(payload)
    print(f"\n{task_result.model_dump_json(exclude_none=True)}")
```

3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞**:
```python
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è
state = TaskState(task_result.result.status.state)
if state.name == TaskState.INPUT_REQUIRED.name:
    # –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –≤—ã–∑–æ–≤ –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è –¥–∏–∞–ª–æ–≥–∞
    return await complete_task(...)
else:
    # –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è
    return True
```

### Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

CLI –∫–ª–∏–µ–Ω—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–æ–ª—É—á–µ–Ω–∏–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ—Ç –∞–≥–µ–Ω—Ç–∞, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—É—á–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ —Å—Ç–∞—Ç—É—Å–µ –∑–∞–¥–∞—á–∏, –¥–∞–∂–µ –µ—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.

1. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–ª—É—à–∞—Ç–µ–ª—è**:
```python
if use_push_notifications:
    from hosts.cli.push_notification_listener import PushNotificationListener
    notification_receiver_auth = PushNotificationReceiverAuth()
    await notification_receiver_auth.load_jwks(f"{agent}/.well-known/jwks.json")

    push_notification_listener = PushNotificationListener(
        host=notification_receiver_host,
        port=notification_receiver_port,
        notification_receiver_auth=notification_receiver_auth,
    )
    push_notification_listener.start()
```

2. **–û–±—Ä–∞–±–æ—Ç–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π**:
```python
async def handle_notification(self, request: Request) -> Response:
    data = await request.json()
    try:
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ JWT
        if not await self.notification_receiver_auth.verify_push_notification(request):
            print("push notification verification failed")
            return Response(status_code=401)
    except Exception as e:
        print(f"error verifying push notification: {e}")
        print(traceback.format_exc())
        return Response(status_code=500)
        
    print(f"\npush notification received => \n{data}\n")
    return Response(status_code=200)
```

3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞**:
```python
async def handle_validation_check(self, request: Request) -> Response:
    validation_token = request.query_params.get("validationToken")
    print(f"\npush notification verification received => \n{validation_token}\n")

    if not validation_token:
        return Response(status_code=400)
        
    return Response(content=validation_token, status_code=200)
```

## üîÑ –ú—É–ª—å—Ç–∏–∞–≥–µ–Ω—Ç–Ω—ã–π –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä

–ú—É–ª—å—Ç–∏–∞–≥–µ–Ω—Ç–Ω—ã–π –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä - —ç—Ç–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –ø–æ—Å—Ä–µ–¥–Ω–∏–∫, —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –Ω–∞ –±–∞–∑–µ Google ADK, –∫–æ—Ç–æ—Ä—ã–π –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∫ –ø–æ–¥—Ö–æ–¥—è—â–∏–º —É–¥–∞–ª–µ–Ω–Ω—ã–º –∞–≥–µ–Ω—Ç–∞–º –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π.

### –ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

```python
# agent.py - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ—Ä–Ω–µ–≤–æ–≥–æ –∞–≥–µ–Ω—Ç–∞
root_agent = HostAgent(
    remote_agent_addresses=["http://localhost:10000"]
).create_agent()

# host_agent.py - –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –∞–≥–µ–Ω—Ç–∞–º–∏
class HostAgent:
    def __init__(self, remote_agent_addresses: List[str], task_callback: Optional[TaskUpdateCallback] = None):
        # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —É–¥–∞–ª–µ–Ω–Ω—ã–º–∏ –∞–≥–µ–Ω—Ç–∞–º–∏
        # ...
        
    def create_agent(self) -> Agent:
        # –°–æ–∑–¥–∞–µ–º –∞–≥–µ–Ω—Ç–∞ Google ADK
        # ...
        
    async def send_task(self, agent_name: str, message: str, tool_context: ToolContext):
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–¥–∞—á—É –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É –∞–≥–µ–Ω—Ç—É
        # ...

# remote_agent_connection.py - –æ–±–µ—Ä—Ç–∫–∞ –¥–ª—è A2AClient
class RemoteAgentConnections:
    def __init__(self, agent_card: AgentCard):
        # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–ª–∏–µ–Ω—Ç –¥–ª—è –∞–≥–µ–Ω—Ç–∞
        # ...
        
    async def send_task(self, request: TaskSendParams, task_callback: Optional[TaskUpdateCallback] = None):
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–¥–∞—á—É –∞–≥–µ–Ω—Ç—É –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–º —Ä–µ–∂–∏–º–µ
        # ...
```

### HostAgent: –æ—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å

`HostAgent` - —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç Multi-Agent –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞, –æ—Ç–≤–µ—á–∞—é—â–∏–π –∑–∞:
- –£—Å—Ç–∞–Ω–æ–≤–∫—É —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π —Å —É–¥–∞–ª–µ–Ω–Ω—ã–º–∏ –∞–≥–µ–Ω—Ç–∞–º–∏
- –°–æ–∑–¥–∞–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫—É –∞–≥–µ–Ω—Ç–∞ Google ADK
- –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è –≤—ã–±–æ—Ä–∞ –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –∞–≥–µ–Ω—Ç–∞–º–∏
- –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —Ñ–æ—Ä–º–∞—Ç–∞–º–∏ A2A –∏ Google ADK

```python
class HostAgent:
    def __init__(self, remote_agent_addresses: List[str], task_callback: Optional[TaskUpdateCallback] = None):
        self.task_callback = task_callback
        self.remote_agent_connections: Dict[str, RemoteAgentConnections] = {}
        self.cards: Dict[str, AgentCard] = {}
        
        # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å–æ –≤—Å–µ–º–∏ —É–¥–∞–ª–µ–Ω–Ω—ã–º–∏ –∞–≥–µ–Ω—Ç–∞–º–∏
        for address in remote_agent_addresses:
            card_resolver = A2ACardResolver(address)
            card = card_resolver.get_agent_card()
            remote_connection = RemoteAgentConnections(card)
            self.remote_agent_connections[card.name] = remote_connection
            self.cards[card.name] = card
            
        # –§–æ—Ä–º–∏—Ä—É–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∞–≥–µ–Ω—Ç–∞—Ö –¥–ª—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
        agent_info = []
        for ra in self.list_remote_agents():
            agent_info.append(json.dumps(ra))
        self.agents = '\n'.join(agent_info)
```

–ö–ª—é—á–µ–≤–æ–π –º–µ—Ç–æ–¥ `create_agent()` —Å–æ–∑–¥–∞–µ—Ç —ç–∫–∑–µ–º–ø–ª—è—Ä Google ADK –∞–≥–µ–Ω—Ç–∞:

```python
def create_agent(self) -> Agent:
    return Agent(
        model="gemini-2.0-flash-001",
        name="host_agent",
        instruction=self.root_instruction,
        before_model_callback=self.before_model_callback,
        description=(
            "This agent orchestrates the decomposition of the user request into"
            " tasks that can be performed by the child agents."
        ),
        tools=[
            self.list_remote_agents,
            self.send_task,
        ],
    )
```

### –ú–µ—Ö–∞–Ω–∏–∑–º –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–¥–∞—á

–û—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –¥–ª—è –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–¥–∞—á —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤ –º–µ—Ç–æ–¥–µ `send_task()`:

```python
async def send_task(
        self,
        agent_name: str,
        message: str,
        tool_context: ToolContext) -> List[Union[str, Dict[str, Any]]]:
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∞–≥–µ–Ω—Ç–∞
    if agent_name not in self.remote_agent_connections:
        raise ValueError(f"Agent {agent_name} not found")
        
    # –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    state = tool_context.state
    state['agent'] = agent_name
    
    # –ü–æ–ª—É—á–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫—É –∏ –∫–ª–∏–µ–Ω—Ç –∞–≥–µ–Ω—Ç–∞
    card = self.cards[agent_name]
    client = self.remote_agent_connections[agent_name]
    
    # –§–æ—Ä–º–∏—Ä—É–µ–º –∑–∞–ø—Ä–æ—Å
    request: TaskSendParams = TaskSendParams(
        id=task_id,
        sessionId=session_id,
        message=Message(
            role="user",
            parts=[TextPart(text=message)],
            metadata=metadata,
        ),
        acceptedOutputModes=["text", "text/plain", "image/png"],
        metadata={'conversation_id': session_id},
    )
    
    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–¥–∞—á—É
    task = await client.send_task(request, self.task_callback)
    
    # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –æ—Ç–≤–µ—Ç
    response = []
    if task.status.message:
        response.extend(convert_parts(task.status.message.parts, tool_context))
    if task.artifacts:
        for artifact in task.artifacts:
            response.extend(convert_parts(artifact.parts, tool_context))
            
    return response
```

–í–∞–∂–Ω–æ–π —á–∞—Å—Ç—å—é —è–≤–ª—è–µ—Ç—Å—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–æ–≤ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É A2A –∏ Google ADK:

```python
def convert_parts(parts: List[Part], tool_context: ToolContext) -> List[Union[str, Dict[str, Any]]]:
    rval = []
    for p in parts:
        rval.append(convert_part(p, tool_context))
    return rval

def convert_part(part: Part, tool_context: ToolContext) -> Union[str, Dict[str, Any]]:
    if part.type == "text":
        return part.text
    elif part.type == "data":
        return part.data
    elif part.type == "file":
        # –ü–µ—Ä–µ–ø–∞–∫–æ–≤—ã–≤–∞–µ–º A2A FilePart –≤ google.genai Blob
        file_id = part.file.name
        file_bytes = base64.b64decode(part.file.bytes)    
        file_part = types.Part(
            inline_data=types.Blob(
                mime_type=part.file.mimeType,
                data=file_bytes
            )
        )
        tool_context.save_artifact(file_id, file_part)
        tool_context.actions.skip_summarization = True
        tool_context.actions.escalate = True
        return DataPart(data={"artifact-file-id": file_id})
    return f"Unknown type: {part.type}"
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö

–î–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–±–º–µ–Ω –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏:

```python
def merge_metadata(target: Any, source: Any) -> None:
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∞—Ç—Ä–∏–±—É—Ç–æ–≤ metadata —É –æ–±–æ–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤
    if not hasattr(target, 'metadata') or not hasattr(source, 'metadata'):
        return
        
    # –ï—Å–ª–∏ –æ–±–∞ –æ–±—ä–µ–∫—Ç–∞ –∏–º–µ—é—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ, –æ–±—ä–µ–¥–∏–Ω—è–µ–º –∏—Ö
    if target.metadata and source.metadata:
        target.metadata.update(source.metadata)
    # –ï—Å–ª–∏ —Ç–æ–ª—å–∫–æ –∏—Å—Ç–æ—á–Ω–∏–∫ –∏–º–µ–µ—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ, –∫–æ–ø–∏—Ä—É–µ–º –∏—Ö –≤ —Ü–µ–ª—å
    elif source.metadata:
        target.metadata = dict(**source.metadata)
```

–í `RemoteAgentConnections` –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è:
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏–π –∏ –¥–∏–∞–ª–æ–≥–æ–≤
- –°–≤—è–∑—ã–≤–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤
- –ü–µ—Ä–µ–¥–∞—á–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏

```python
# –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è—Ö —Å—Ç–∞—Ç—É—Å–∞
if (hasattr(response.result, 'status') and
        hasattr(response.result.status, 'message') and
        response.result.status.message):
    merge_metadata(response.result.status.message, request.message)
    message = response.result.status.message
    
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ, –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç
    if not message.metadata:
        message.metadata = {}
        
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å–æ–æ–±—â–µ–Ω–∏—è
    if 'message_id' in message.metadata:
        message.metadata['last_message_id'] = message.metadata['message_id']
        
    # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–≤—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å–æ–æ–±—â–µ–Ω–∏—è
    message.metadata['message_id'] = str(uuid.uuid4())
```

## üîÑ –ü–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö

### –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö CLI –∫–ª–∏–µ–Ω—Ç–∞

```mermaid
sequenceDiagram
    participant User as –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
    participant CLI as CLI –∫–ª–∏–µ–Ω—Ç
    participant Client as A2AClient
    participant Listener as PushNotificationListener
    participant Agent as A2A –ê–≥–µ–Ω—Ç

    User->>CLI: –í–≤–æ–¥ –∑–∞–ø—Ä–æ—Å–∞
    CLI->>Client: –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞
    
    alt –ü–æ—Ç–æ–∫–æ–≤—ã–π —Ä–µ–∂–∏–º
        Client->>Agent: send_task_streaming(payload)
        loop –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ—Ç–æ–∫–∞
            Agent-->>Client: –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
            Client-->>CLI: –û–±–Ω–æ–≤–ª–µ–Ω–∏—è
            CLI-->>User: –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
        end
        Client->>Agent: get_task(task_id)
        Agent-->>Client: –§–∏–Ω–∞–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    else –û–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º
        Client->>Agent: send_task(payload)
        Agent-->>Client: –†–µ–∑—É–ª—å—Ç–∞—Ç
    end
    
    Client-->>CLI: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞
    CLI-->>User: –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    
    alt –ù–µ–æ–±—Ö–æ–¥–∏–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –≤–≤–æ–¥
        CLI->>User: –ó–∞–ø—Ä–æ—Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
        User->>CLI: –í–≤–æ–¥ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
        Note over CLI, Agent: –ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ —Ü–∏–∫–ª–∞ —Å —Ç–µ–º –∂–µ task_id
    end
    
    alt Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤–∫–ª—é—á–µ–Ω—ã
        Agent->>Listener: GET /notify?validationToken=X
        Listener-->>Agent: 200 OK (validationToken)
        Agent->>Listener: POST /notify (JWT-–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
        Listener->>Listener: –ü—Ä–æ–≤–µ—Ä–∫–∞ JWT –ø–æ–¥–ø–∏—Å–∏
        Listener-->>Agent: 200 OK
        Listener-->>CLI: –í—ã–≤–æ–¥ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        CLI-->>User: –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    end
```

### –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö Multi-Agent –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞

```mermaid
sequenceDiagram
    participant App as –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
    participant HostAgent as HostAgent
    participant Gemini as –ú–æ–¥–µ–ª—å Gemini
    participant RAConn as RemoteAgentConnections
    participant Client as A2AClient
    participant Agent as A2A –ê–≥–µ–Ω—Ç

    App->>HostAgent: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    HostAgent->>HostAgent: –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–µ–∫ –∞–≥–µ–Ω—Ç–æ–≤
    
    App->>HostAgent: –ó–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    HostAgent->>Gemini: –ê–Ω–∞–ª–∏–∑ –∑–∞–ø—Ä–æ—Å–∞
    Gemini->>HostAgent: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–¥—Ö–æ–¥—è—â–µ–≥–æ –∞–≥–µ–Ω—Ç–∞
    
    HostAgent->>RAConn: send_task(agent_name, message)
    RAConn->>Client: –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞
    
    alt –ü–æ—Ç–æ–∫–æ–≤—ã–π —Ä–µ–∂–∏–º
        Client->>Agent: send_task_streaming(request)
        loop –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ—Ç–æ–∫–∞
            Agent-->>Client: –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∏
            Client-->>RAConn: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ callback
            RAConn-->>HostAgent: –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
            HostAgent-->>Gemini: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
        end
    else –û–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º
        Client->>Agent: send_task(request)
        Agent-->>Client: –†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–¥–∞—á–∏
    end
    
    RAConn->>HostAgent: –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ –∞–≥–µ–Ω—Ç–∞
    HostAgent->>HostAgent: convert_parts()
    HostAgent->>Gemini: –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
    Gemini->>HostAgent: –§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
    HostAgent->>App: –í–æ–∑–≤—Ä–∞—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
```

## üí° –ü—Ä–∏–º–µ—Ä—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CLI –∫–ª–∏–µ–Ω—Ç–∞

```bash
# –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å –ª–æ–∫–∞–ª—å–Ω—ã–º –∞–≥–µ–Ω—Ç–æ–º
python -m hosts.cli --agent http://localhost:10000

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏
python -m hosts.cli --agent http://localhost:10000 --use_push_notifications

# –ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å–µ—Å—Å–∏–∏ —Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –∏—Å—Ç–æ—Ä–∏–∏
python -m hosts.cli --agent http://localhost:10000 --session abcdef123456 --history
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Multi-Agent –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

```python
# –ò–º–ø–æ—Ä—Ç –∫–æ—Ä–Ω–µ–≤–æ–≥–æ –∞–≥–µ–Ω—Ç–∞
from hosts.multiagent.agent import root_agent

# –ü—Ä–∏–º–µ—Ä —Å–æ–∑–¥–∞–Ω–∏—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∞–≥–µ–Ω—Ç–∞ —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –∞–¥—Ä–µ—Å–∞–º–∏
from hosts.multiagent.host_agent import HostAgent

custom_host_agent = HostAgent(
    remote_agent_addresses=[
        "http://localhost:10000",
        "http://localhost:10001",
        "http://localhost:10002"
    ]
).create_agent()

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞
async def process_user_request(user_message, user_id, session_id):
    content = types.Content(
        role="user", 
        parts=[types.Part.from_text(text=user_message)]
    )
    
    # –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    events = root_agent.run(
        user_id=user_id,
        session_id=session_id,
        new_message=content
    )
    
    # –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    for event in events:
        if event.content and event.content.parts:
            responses = [p.text for p in event.content.parts if p.text]
            return "\n".join(responses)
    
    return "–ù–µ—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç –∞–≥–µ–Ω—Ç–∞"
```

### –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π CLI –∫–ª–∏–µ–Ω—Ç–∞

```python
# –ü—Ä–∏–º–µ—Ä –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π –æ–ø—Ü–∏–∏ CLI
@click.command()
@click.option("--agent", default="http://localhost:10000", help="URL –∞–≥–µ–Ω—Ç–∞")
@click.option("--debug", default=False, help="–í–∫–ª—é—á–∏—Ç—å –æ—Ç–ª–∞–¥–æ—á–Ω—ã–π —Ä–µ–∂–∏–º")
@click.option("--timeout", default=30, help="–¢–∞–π–º–∞—É—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö")
async def extended_cli(agent: str, debug: bool, timeout: int):
    # –ö–æ–¥ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
    
    # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
    if debug:
        logging.basicConfig(level=logging.DEBUG)
    
    # –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ —Å —Ç–∞–π–º–∞—É—Ç–æ–º
    client = A2AClient(agent_card=card, timeout=timeout)
    
    # –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª
    # ...
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ –∫–æ–Ω—Ç–µ–Ω—Ç–∞

```python
# –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ convert_part –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤
def extended_convert_part(part: Part, tool_context: ToolContext) -> Union[str, Dict[str, Any]]:
    if part.type == "text":
        return part.text
    elif part.type == "data":
        return part.data
    elif part.type == "file":
        # –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤
        # ...
    elif part.type == "audio":
        # –û–±—Ä–∞–±–æ—Ç–∫–∞ –∞—É–¥–∏–æ-–∫–æ–Ω—Ç–µ–Ω—Ç–∞
        audio_id = f"audio_{uuid.uuid4().hex}"
        audio_bytes = base64.b64decode(part.audio.bytes)
        audio_part = types.Part(
            inline_data=types.Blob(
                mime_type=part.audio.mimeType,
                data=audio_bytes
            )
        )
        tool_context.save_artifact(audio_id, audio_part)
        return DataPart(data={"artifact-audio-id": audio_id})
    return f"Unknown type: {part.type}"
```